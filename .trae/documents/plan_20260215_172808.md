# Java UT Agent - AI驱动的JUnit5单元测试生成器

## 系统架构

```
┌─────────────────────────────────────────────────────────────────┐
│                        CLI Interface                             │
│  (命令行参数解析、进度显示、结果报告)                              │
└─────────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────────┐
│                    Iterative Optimizer                           │
│  (迭代优化器：根据覆盖率目标循环生成测试)                          │
└─────────────────────────────────────────────────────────────────┘
         │                    │                    │
         ▼                    ▼                    ▼
┌──────────────┐    ┌──────────────┐    ┌──────────────┐
│ Code Parser  │───▶│Test Generator│───▶│  Coverage    │
│ (JavaParser) │    │  (AI+LLM)    │    │  Analyzer    │
│ 代码解析器    │    │  测试生成器   │    │  (JaCoCo)    │
└──────────────┘    └──────────────┘    └──────────────┘
         │                    │
         ▼                    ▼
┌─────────────────────────────────────────────────────────────────┐
│              Framework Detection & Strategy                      │
│  (框架检测与策略：Spring/SpringBoot/MyBatis/MyBatis-Plus)         │
└─────────────────────────────────────────────────────────────────┘
```

## JDK版本支持

**支持 JDK 17 和 JDK 21**
- 使用 Java 17 语法特性（Records、Sealed Classes等）
- 兼容 JDK 21 运行时（Virtual Threads支持）

## 框架支持

### Spring MVC / Spring Boot
- **Controller层测试**：使用 MockMvc 进行Web层测试
- **Service层测试**：使用 @ExtendWith + @Mock 注解
- **Repository层测试**：支持 @DataJpaTest
- **集成测试**：使用 @SpringBootTest + @AutoConfigureMockMvc

### MyBatis / MyBatis Plus
- **Mapper接口测试**：使用 @MybatisTest (MyBatis) 或 @MybatisPlusTest
- **SQL测试**：支持内嵌数据库(H2)或Testcontainers
- **分页测试**：自动生成分页查询测试用例

## 核心模块

### 1. Code Parser (代码解析器)
- 使用 **JavaParser 3.26.x** 解析Java源代码为AST
- **框架注解识别**：@Controller, @Service, @Repository, @Mapper, @RestController等
- **依赖注入分析**：@Autowired, @Resource, @Qualifier等
- **MyBatis注解**：@Select, @Insert, @Update, @Delete, @Mapper等

### 2. Test Generator (测试生成器)
- **策略模式**：根据检测到的框架选择生成策略
- **Spring策略**：生成@SpringBootTest, @WebMvcTest等
- **MyBatis策略**：生成@MybatisTest, Mapper测试
- **AI增强**：调用LLM API生成高质量测试用例

### 3. Coverage Analyzer (覆盖率分析器)
- 集成 **JaCoCo 0.8.11+** 进行覆盖率分析
- 支持多模块项目覆盖率聚合

### 4. Iterative Optimizer (迭代优化器)
- 设定目标覆盖率阈值
- 循环：生成测试 → 运行测试 → 分析覆盖率 → 补充测试

## 项目结构

```
java-ut-agent/
├── pom.xml
├── src/main/java/com/utagent/
│   ├── JavaUTAgentApplication.java
│   ├── parser/                    # 代码解析模块
│   │   ├── JavaCodeParser.java
│   │   └── FrameworkDetector.java # 框架检测器
│   ├── generator/                 # 测试生成模块
│   │   ├── TestGenerator.java
│   │   └── strategy/              # 框架策略
│   │       ├── SpringTestStrategy.java
│   │       ├── SpringBootTestStrategy.java
│   │       ├── MyBatisTestStrategy.java
│   │       └── MyBatisPlusTestStrategy.java
│   ├── coverage/                  # 覆盖率分析模块
│   ├── optimizer/                 # 迭代优化模块
│   └── cli/                       # 命令行接口
└── src/test/
```

## 技术栈
- **Java 17+ / JDK 21**
- **JavaParser 3.26.x** - 源码解析
- **JaCoCo 0.8.11+** - 覆盖率分析
- **JUnit 5.10+** - 测试框架
- **Mockito 5.x** - Mock框架
- **Spring Test** - Spring测试支持
- **MyBatis-Test** - MyBatis测试支持
- **Picocli 4.x** - CLI框架
- **OpenAI API / Claude API** - AI测试生成

## 实现步骤

1. **项目初始化** - Maven项目，JDK 17/21，多框架依赖
2. **框架检测模块** - 识别Spring/MyBatis框架
3. **代码解析模块** - JavaParser集成，注解解析
4. **测试生成模块** - 多框架策略实现
5. **覆盖率分析模块** - JaCoCo集成
6. **迭代优化模块** - 闭环优化逻辑
7. **CLI模块** - 命令行交互
8. **测试验证** - 功能测试